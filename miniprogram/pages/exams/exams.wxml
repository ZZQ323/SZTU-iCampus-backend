<view class="exams-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <custom-navbar title="è€ƒè¯•å®‰æ’" showBack="{{true}}" background="{{'#2E8B57'}}"></custom-navbar>

  <!-- è€ƒè¯•ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stats-cards">
      <view class="stat-card">
        <view class="stat-number">{{examStats.total}}</view>
        <view class="stat-label">æ€»è€ƒè¯•</view>
      </view>
      <view class="stat-card">
        <view class="stat-number" style="color: #ff9500;">{{examStats.upcoming}}</view>
        <view class="stat-label">å¾…è€ƒè¯•</view>
      </view>
      <view class="stat-card">
        <view class="stat-number" style="color: #00a870;">{{examStats.completed}}</view>
        <view class="stat-label">å·²å®Œæˆ</view>
      </view>
      <view class="stat-card">
        <view class="stat-number" style="color: #0052d9;">{{examStats.averageScore}}</view>
        <view class="stat-label">å¹³å‡åˆ†</view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘è€ƒè¯•æé†’ -->
  <view class="next-exam-section" wx:if="{{nextExam}}">
    <view class="next-exam-card">
      <view class="exam-urgent-badge">æœ€è¿‘è€ƒè¯•</view>
      <view class="exam-course">{{nextExam.course_name}}</view>
      <view class="exam-time">{{nextExam.exam_date}} {{nextExam.start_time}}</view>
      <view class="exam-location">ğŸ“ {{nextExam.location}} åº§ä½ï¼š{{nextExam.seat_number}}</view>
      <view class="countdown-section">
        <view class="countdown-label">è·ç¦»è€ƒè¯•è¿˜æœ‰</view>
        <view class="countdown-time">{{countdown}}</view>
      </view>
      <view class="exam-actions">
        <view class="action-btn" data-exam="{{nextExam}}" bindtap="onViewSeat">
          <t-icon name="location" size="16" color="#0052d9" />
          <text>åº§ä½</text>
        </view>
        <view class="action-btn" data-exam="{{nextExam}}" bindtap="onSetReminder">
          <t-icon name="notification" size="16" color="#0052d9" />
          <text>æé†’</text>
        </view>
        <view class="action-btn primary" data-exam="{{nextExam}}" bindtap="onViewDetail">
          <t-icon name="file-text" size="16" color="white" />
          <text>è¯¦æƒ…</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆç»©é¢„å‘Š -->
  <view class="grade-notifications" wx:if="{{gradeNotifications.length > 0}}">
    <view class="section-header">
      <view class="section-title">ğŸ“Š æˆç»©åŠ¨æ€</view>
    </view>
    <view class="notification-list">
      <view class="notification-item" wx:for="{{gradeNotifications}}" wx:key="id">
        <view class="notification-icon {{item.type}}">
          <t-icon name="{{item.type === 'grade_published' ? 'check-circle' : 'time'}}" 
                  size="16" 
                  color="{{item.type === 'grade_published' ? '#00a870' : '#ff9500'}}" />
        </view>
        <view class="notification-info">
          <view class="notification-course">{{item.course}}</view>
          <view class="notification-message">{{item.message}}</view>
          <view class="notification-time">{{item.time}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- è€ƒè¯•ç±»å‹åˆ‡æ¢ -->
  <view class="type-selector">
    <t-radio-group value="{{currentType}}" bind:change="onTypeChange">
      <view class="radio-list">
        <t-radio wx:for="{{examTypes}}" wx:key="value" 
                 value="{{item.value}}" 
                 label="{{item.label}}" />
      </view>
    </t-radio-group>
  </view>

  <!-- è€ƒè¯•åˆ—è¡¨ -->
  <view class="exams-section">
    <view wx:if="{{loading}}" class="loading-container">
      <t-loading size="24" />
      <text>åŠ è½½è€ƒè¯•ä¿¡æ¯ä¸­...</text>
    </view>

    <view wx:elif="{{exams.length === 0}}" class="empty-state">
      <t-icon name="calendar" size="48" color="#ccc" />
      <view class="empty-text">æš‚æ— {{currentTypeLabel}}å®‰æ’</view>
      <view class="empty-subtitle">è¯·é€‰æ‹©å…¶ä»–è€ƒè¯•ç±»å‹æŸ¥çœ‹</view>
    </view>

    <view wx:else class="exam-list">
      <view class="exam-item {{item.status}}" wx:for="{{exams}}" wx:key="id">
        <!-- è€ƒè¯•çŠ¶æ€æ ‡ç­¾ -->
        <view class="exam-status-badge {{item.status}}">
          {{item.status === 'upcoming' ? 'å¾…è€ƒè¯•' : item.status === 'completed' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}}
        </view>
        
        <!-- è€ƒè¯•åŸºæœ¬ä¿¡æ¯ -->
        <view class="exam-header">
          <view class="exam-course-info">
            <view class="course-name">{{item.course_name}}</view>
            <view class="course-code">{{item.course_code}}</view>
          </view>
          <view class="exam-score" wx:if="{{item.score}}">
            <view class="score-value">{{item.score}}</view>
            <view class="score-total">/{{item.totalScore}}</view>
          </view>
        </view>

        <!-- è€ƒè¯•æ—¶é—´åœ°ç‚¹ -->
        <view class="exam-info">
          <view class="info-row">
            <t-icon name="time" size="16" color="#666" />
            <text>{{item.exam_date}} {{item.start_time}}-{{item.end_time}}</text>
          </view>
          <view class="info-row">
            <t-icon name="location" size="16" color="#666" />
            <text>{{item.location}} åº§ä½ï¼š{{item.seat_number}}</text>
          </view>
          <view class="info-row">
            <t-icon name="user" size="16" color="#666" />
            <text>{{item.instructor}}</text>
          </view>
        </view>

        <!-- è€ƒè¯•æç¤º -->
        <view class="exam-tips" wx:if="{{item.tips}}">
          <t-icon name="lightbulb" size="14" color="#ff9500" />
          <text class="tips-text">{{item.tips}}</text>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="exam-actions">
          <view class="action-btn" data-exam="{{item}}" bindtap="onViewSeat">
            <t-icon name="location" size="14" color="#666" />
            <text>åº§ä½</text>
          </view>
          <view class="action-btn" data-exam="{{item}}" bindtap="onSetReminder" wx:if="{{item.status === 'upcoming'}}">
            <t-icon name="notification" size="14" color="#666" />
            <text>æé†’</text>
          </view>
          <view class="action-btn" data-exam="{{item}}" bindtap="onViewDetail">
            <t-icon name="file-text" size="14" color="#666" />
            <text>è¯¦æƒ…</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è€ƒè¯•æ”»ç•¥ -->
  <view class="tips-section">
    <view class="section-header">
      <view class="section-title">ğŸ’¡ è€ƒè¯•æ”»ç•¥</view>
    </view>
    <view class="tips-grid">
      <view class="tip-card" wx:for="{{examTips}}" wx:key="id" data-tip="{{item}}" bindtap="onViewTips">
        <view class="tip-icon">
          <text>{{item.title.substring(0, 2)}}</text>
        </view>
        <view class="tip-content">
          <view class="tip-title">{{item.title.substring(3)}}</view>
          <view class="tip-preview">{{item.content.split('\\n')[0]}}</view>
        </view>
        <t-icon name="chevron-right" size="16" color="#ccc" />
      </view>
    </view>
  </view>

  <!-- è€ƒè¯•æ—¥å†è§†å›¾ -->
  <view class="calendar-modal" wx:if="{{calendarView}}" bindtap="onToggleCalendar">
    <view class="calendar-content" catchtap="">
      <view class="calendar-header">
        <view class="calendar-title">è€ƒè¯•æ—¥å†</view>
        <t-icon name="close" size="20" color="#666" bindtap="onToggleCalendar" />
      </view>
      <view class="calendar-events">
        <view class="calendar-event" wx:for="{{calendarEvents}}" wx:key="date">
          <view class="event-date">{{item.date}}</view>
          <view class="event-info">
            <view class="event-title">{{item.title}}</view>
            <view class="event-time">{{item.time}}</view>
            <view class="event-location">{{item.location}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view> 