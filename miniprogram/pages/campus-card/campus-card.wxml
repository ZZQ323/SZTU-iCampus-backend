<view class="campus-card-container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <custom-navbar 
    title="æ ¡å›­å¡" 
    background="#7c4dff"
    color="#ffffff"
  />

  <!-- æ ¡å›­å¡å¡ç‰‡ -->
  <view class="card-section">
    <view class="campus-card {{cardInfo.status === 'lost' ? 'card-lost' : ''}}">
      <!-- å¡ç‰‡çŠ¶æ€æŒ‡ç¤ºå™¨ -->
      <view class="card-status" wx:if="{{cardInfo.status !== 'normal'}}">
        <view class="status-indicator {{cardInfo.status}}">
          {{cardInfo.status === 'lost' ? 'å·²æŒ‚å¤±' : 'å·²å†»ç»“'}}
        </view>
      </view>
      
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="card-header">
        <view class="user-avatar">
          <image src="{{userInfo.avatar}}" mode="aspectFill" />
        </view>
        <view class="user-info">
          <view class="user-name">{{userInfo.name}}</view>
          <view class="user-id">å­¦å·ï¼š{{userInfo.studentId}}</view>
          <view class="card-number">å¡å·ï¼š{{cardInfo.cardNumber}}</view>
        </view>
        <view class="card-logo">
          <text>SZTU</text>
        </view>
      </view>

      <!-- ä½™é¢ä¿¡æ¯ -->
      <view class="balance-section">
        <view class="balance-label">è´¦æˆ·ä½™é¢</view>
        <view class="balance-amount">Â¥{{cardInfo.balance}}</view>
        <view class="last-update">æœ€åæ›´æ–°ï¼š{{cardInfo.lastUpdateTime}}</view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="card-actions">
        <view class="action-btn primary" bindtap="onRecharge">
          <t-icon name="add" size="18" color="white" />
          <text>å……å€¼</text>
        </view>
        <view class="action-btn secondary" bindtap="onViewRecords">
          <t-icon name="format-list-bulleted" size="18" color="#0052d9" />
          <text>è®°å½•</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¶ˆè´¹ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="section-header">
      <view class="section-title">ğŸ“Š æ¶ˆè´¹ç»Ÿè®¡</view>
    </view>
    
    <view class="stats-cards">
      <view class="stat-card">
        <view class="stat-amount">Â¥{{todaySpending}}</view>
        <view class="stat-label">ä»Šæ—¥æ¶ˆè´¹</view>
      </view>
      <view class="stat-card">
        <view class="stat-amount">Â¥{{monthlySpending}}</view>
        <view class="stat-label">æœ¬æœˆæ¶ˆè´¹</view>
      </view>
      <view class="stat-card">
        <view class="stat-amount">{{recentRecords.length}}</view>
        <view class="stat-label">è¿‘æœŸäº¤æ˜“</view>
      </view>
    </view>

    <!-- æ¶ˆè´¹åˆ†ç±»ç»Ÿè®¡ -->
    <view class="category-stats">
      <view class="category-header">æ¶ˆè´¹åˆ†ç±»</view>
      <view class="category-list">
        <view class="category-item" wx:for="{{spendingStats.categories}}" wx:key="name">
          <view class="category-info">
            <view class="category-name">{{item.name}}</view>
            <view class="category-amount">Â¥{{item.amount}}</view>
          </view>
          <view class="category-bar">
            <view class="bar-fill" style="width: {{item.percentage}}%; background: {{item.color}};"></view>
          </view>
          <view class="category-percentage">{{item.percentage}}%</view>
        </view>
      </view>
    </view>
  </view>

  <!-- è¿‘æœŸäº¤æ˜“è®°å½• -->
  <view class="records-section">
    <view class="section-header">
      <view class="section-title">ğŸ’° è¿‘æœŸäº¤æ˜“</view>
      <view class="section-action" bindtap="onViewRecords">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <t-icon name="chevron-right" size="16" color="#0052d9" />
      </view>
    </view>

    <view wx:if="{{loading}}" class="loading-container">
      <t-loading size="24" />
      <text>åŠ è½½ä¸­...</text>
    </view>

    <view wx:elif="{{recentRecords.length === 0}}" class="empty-state">
      <t-icon name="receipt" size="48" color="#ccc" />
      <view class="empty-text">æš‚æ— äº¤æ˜“è®°å½•</view>
    </view>

    <view wx:else class="records-list">
      <view class="record-item" wx:for="{{recentRecords}}" wx:key="id" wx:if="{{index < 5}}">
        <view class="record-icon">
          <t-icon name="{{item.type === 'recharge' ? 'add-circle' : 'remove-circle'}}" 
                  size="20" 
                  color="{{item.type === 'recharge' ? '#00a870' : '#0052d9'}}" />
        </view>
        <view class="record-info">
          <view class="record-location">{{item.location}}</view>
          <view class="record-time">{{item.time}}</view>
          <view class="record-description">{{item.description}}</view>
        </view>
        <view class="record-amount {{item.type}}">
          {{item.amount}}
        </view>
      </view>
    </view>
  </view>

  <!-- æœåŠ¡åŠŸèƒ½ -->
  <view class="services-section">
    <view class="section-header">
      <view class="section-title">ğŸ› ï¸ æœåŠ¡åŠŸèƒ½</view>
    </view>

    <view class="services-grid">
      <view class="service-item" 
            wx:for="{{services}}" 
            wx:key="id" 
            data-service="{{item}}" 
            bindtap="onServiceTap">
        <view class="service-icon">
          <t-icon name="{{item.icon}}" size="24" color="#0052d9" />
        </view>
        <view class="service-info">
          <view class="service-name">{{item.name}}</view>
          <view class="service-desc">{{item.desc}}</view>
        </view>
        <t-icon name="chevron-right" size="16" color="#ccc" />
      </view>
    </view>
  </view>

  <!-- å¸¸ç”¨åœ°ç‚¹ç»Ÿè®¡ -->
  <view class="locations-section">
    <view class="section-header">
      <view class="section-title">ğŸ“ å¸¸ç”¨åœ°ç‚¹</view>
    </view>

    <view class="locations-list">
      <view class="location-item" wx:for="{{spendingStats.locations}}" wx:key="name">
        <view class="location-info">
          <view class="location-name">{{item.name}}</view>
          <view class="location-stats">
            <text class="visit-count">{{item.count}}æ¬¡æ¶ˆè´¹</text>
            <text class="total-amount">æ€»è®¡Â¥{{item.amount}}</text>
          </view>
        </view>
        <view class="location-indicator">
          <view class="amount-circle">Â¥{{item.amount}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œæ‚¬æµ®æŒ‰é’® -->
  <view class="fab-container">
    <view class="fab-button" bindtap="onRecharge">
      <t-icon name="add" size="24" color="white" />
    </view>
  </view>
</view> 