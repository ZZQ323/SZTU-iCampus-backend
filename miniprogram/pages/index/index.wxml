<!-- é¦–é¡µ -->
<view class="page">
  <view class="bblank"></view>
  <!-- é¡¶éƒ¨ç”¨æˆ·å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-info">
      <image src="../../assets/test/man.png" class="user-avatar" mode="aspectFill"></image>
      <view class="user-details">
        <view class="user-name">{{userInfo.name || 'ç‚¹å‡»ç™»å½•'}}</view>
        <view class="user-id">{{userInfo.studentId || 'æœªç™»å½•'}}</view>
      </view>
    </view>
    <view class="user-actions">
      <button wx:if="{{!userInfo.name}}" size="mini" class="custom-btn login-btn" bindtap="navigateToLogin">ç™»å½•</button>
      <button wx:if="{{userInfo.name}}" size="mini" class="custom-btn logout-btn" bindtap="onLogout">é€€å‡º</button>
      <button wx:if="{{userInfo.isAdmin}}" size="mini" class="custom-btn admin-btn" bindtap="navigateToAdmin">ç®¡ç†</button>
    </view>
  </view>

  <!-- å¿«æ·æœåŠ¡ç½‘æ ¼ -->
  <view class="section">
    <view class="section-title">æ ¡å›­æœåŠ¡</view>
    <view class="service-grid">
      <view 
        wx:for="{{quickServices}}" 
        wx:key="title"
        class="service-item" 
        bindtap="navigateToService"
        data-item="{{item}}"
      >
        <view class="service-icon-text">{{item.icon}}</view>
        <text class="service-text">{{item.title}}</text>
      </view>
    </view>
  </view>

  <!-- æœ€æ–°å…¬å‘Š -->
  <view class="section">
    <view class="section-header">
      <view class="section-title">æœ€æ–°å…¬å‘Š</view>
      <t-button theme="light" size="small" bindtap="navigateToAnnouncements">æŸ¥çœ‹æ›´å¤š</t-button>
    </view>
    <t-cell-group wx:if="{{announcements.length > 0}}">
      <t-cell 
        wx:for="{{announcements}}" 
        wx:key="id"
        title="{{item.title}}"
        description="{{item.department}} Â· {{item.date}}"
        arrow
        bindtap="viewAnnouncementDetail"
        data-announcement="{{item}}"
      ></t-cell>
    </t-cell-group>
    <view wx:else class="empty-state">
      <text>æš‚æ— å…¬å‘Š</text>
    </view>
  </view>

  <!-- æµå¼æ•°æ®çŠ¶æ€ -->
  <view class="stream-status" wx:if="{{streamStatus.isConnected}}">
    <text class="status-text">ğŸŒŠ å®æ—¶æ•°æ®å·²è¿æ¥</text>
    <text class="status-detail">{{streamStatus.connectionTime}}</text>
  </view>

  <!-- åå‹¤è”ç³»ç”µè¯ -->
  <view class="section contact-section">
    <view class="section-title">åå‹¤è”ç³»ç”µè¯</view>
    <view class="contact-grid">
      <view 
        wx:for="{{contactInfo}}" 
        wx:key="name"
        class="contact-item"
      >
        <view class="contact-header">
          <view class="contact-icon">{{item.icon}}</view>
          <view class="contact-details">
            <view class="contact-name">{{item.name}}</view>
            <view class="contact-category">{{item.category}}</view>
          </view>
        </view>
        <view class="contact-phone">{{item.phone}}</view>
        <view class="contact-actions">
          <view 
            class="action-btn call-btn" 
            bindtap="makePhoneCall"
            data-phone="{{item.phone}}"
            data-name="{{item.name}}"
          >
            ğŸ“ æ‹¨æ‰“
          </view>
          <view 
            class="action-btn copy-btn" 
            bindtap="copyPhoneNumber"
            data-phone="{{item.phone}}"
            data-name="{{item.name}}"
          >
            ğŸ“‹ å¤åˆ¶
          </view>
        </view>
      </view>
    </view>
    <view class="contact-footer">
      <text class="footer-tip">ğŸ’¡ ç´§æ€¥æƒ…å†µè¯·æ‹¨æ‰“ä¿å«å¤„ç”µè¯</text>
    </view>
  </view>
</view>

<!-- å…¬å‘Šè¯¦æƒ…å¼¹çª— -->
<t-dialog
  visible="{{showDialog}}"
  title="{{dialogData.title}}"
  content="{{dialogData.content}}"
  confirm-btn="æŸ¥çœ‹è¯¦æƒ…"
  cancel-btn="å…³é—­"
  bind:confirm="onDialogConfirm"
  bind:cancel="onDialogCancel"
></t-dialog> 