<!-- SZTU-iCampus é¦–é¡µ -->
<view class="page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="bblank"></view>

  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-left">
      <view class="user-avatar" bindtap="onUserAvatarTap">
        <image src="{{homeData.user_info.avatar}}" mode="aspectFill"></image>
        <!-- æœªç™»å½•çŠ¶æ€æ˜¾ç¤ºç™»å½•æç¤º -->
        <view class="login-overlay" wx:if="{{!isLoggedIn}}">
          <text class="login-text">ç‚¹å‡»ç™»å½•</text>
        </view>
      </view>
      <view class="user-info">
        <view class="user-name">{{homeData.user_info.name}}</view>
        <!-- æ ¹æ®ç”¨æˆ·ç±»å‹æ˜¾ç¤ºä¸åŒä¿¡æ¯ -->
        <view class="user-id" wx:if="{{isLoggedIn && userInfo.person_type === 'student'}}">
          å­¦å·ï¼š{{homeData.user_info.student_id}}
        </view>
        <view class="user-id" wx:elif="{{isLoggedIn && (userInfo.person_type === 'teacher' || userInfo.person_type === 'assistant_teacher')}}">
          å·¥å·ï¼š{{homeData.user_info.student_id}}
        </view>
        <view class="user-id" wx:elif="{{isLoggedIn && userInfo.person_type === 'admin'}}">
          ç®¡ç†å‘˜ï¼š{{homeData.user_info.student_id}}
        </view>
        <view class="user-id" wx:else>ç‚¹å‡»å¤´åƒç™»å½•</view>
        
        <view class="user-college" wx:if="{{isLoggedIn}}">{{homeData.user_info.college}}</view>
        <view class="user-college" wx:if="{{isLoggedIn && homeData.user_info.major}}">{{homeData.user_info.major}}</view>
      </view>
    </view>
    <view class="user-stats">
      <!-- å­¦ç”Ÿç»Ÿè®¡ -->
      <view wx:if="{{userInfo.person_type === 'student'}}" class="stat-items">
        <view class="stat-item">
          <text class="stat-number">{{homeData.today_stats.courses}}</text>
          <text class="stat-label">ä»Šæ—¥è¯¾ç¨‹</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{homeData.today_stats.library_books}}</text>
          <text class="stat-label">åœ¨å€Ÿå›¾ä¹¦</text>
        </view>
      </view>
      <!-- æ•™å¸ˆç»Ÿè®¡ -->
      <view wx:elif="{{userInfo.person_type === 'teacher' || userInfo.person_type === 'assistant_teacher'}}" class="stat-items">
        <view class="stat-item">
          <text class="stat-number">{{homeData.today_stats.courses}}</text>
          <text class="stat-label">ä»Šæ—¥è¯¾ç¨‹</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{homeData.today_stats.students || 0}}</text>
          <text class="stat-label">å­¦ç”Ÿæ•°</text>
        </view>
      </view>
      <!-- ç®¡ç†å‘˜ç»Ÿè®¡ -->
      <view wx:elif="{{userInfo.person_type === 'admin'}}" class="stat-items">
        <view class="stat-item">
          <text class="stat-number">{{homeData.today_stats.total_users || 0}}</text>
          <text class="stat-label">ç”¨æˆ·æ€»æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{homeData.today_stats.active_sessions || 0}}</text>
          <text class="stat-label">åœ¨çº¿ä¼šè¯</text>
        </view>
      </view>
      <!-- è®¿å®¢ç»Ÿè®¡ -->
      <view wx:else class="stat-items">
        <view class="stat-item">
          <text class="stat-number">0</text>
          <text class="stat-label">è¯·ç™»å½•</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">ğŸ“</text>
          <text class="stat-label">SZTU</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·åŠŸèƒ½ç½‘æ ¼ -->
  <view class="quick-section">
    <view class="section-title">
      <text wx:if="{{isLoggedIn}}">å¿«æ·æœåŠ¡</text>
      <text wx:else>è®¿å®¢åŠŸèƒ½</text>
    </view>
    <view class="quick-grid">
      <view 
        class="grid-item" 
        wx:for="{{homeData.quick_actions}}" 
        wx:key="name"
        bindtap="navigateTo" 
        data-url="{{item.path}}"
        data-action="{{item.action}}"
      >
        <view class="grid-icon-wrapper">
          <image src="/assets/icons/{{item.icon}}.png" class="grid-icon"></image>
        </view>
        <text class="grid-text">{{item.name}}</text>
      </view>
    </view>
    
    <!-- æœªç™»å½•æç¤º -->
    <view class="login-prompt" wx:if="{{!isLoggedIn}}">
      <text class="prompt-text">ğŸ” ç™»å½•åå¯ä½¿ç”¨æ›´å¤šåŠŸèƒ½</text>
      <t-button size="small" theme="primary" bindtap="goToLogin" class="login-btn">
        ç«‹å³ç™»å½•
      </t-button>
    </view>
  </view>

  <!-- ä»Šæ—¥è¯¾è¡¨ -->
  <view class="section" wx:if="{{isLoggedIn && homeData.today_schedule.length > 0}}">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥è¯¾è¡¨</text>
      <text class="section-more" bindtap="navigateTo" data-url="/pages/schedule/schedule">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <view class="schedule-container">
      <view 
        class="schedule-item {{item.status}}" 
        wx:for="{{homeData.today_schedule}}" 
        wx:key="id"
      >
        <view class="schedule-time">
          <text class="time-text">{{item.time}}</text>
          <view class="status-dot" wx:if="{{item.status === 'current'}}"></view>
        </view>
        <view class="schedule-info">
          <text class="course-name">{{item.course_name}}</text>
          <text class="course-detail">
            <text wx:if="{{item.teacher}}">{{item.teacher}} Â· {{item.location}}</text>
            <text wx:else>{{item.class_name}} Â· {{item.location}}</text>
          </text>
        </view>
        <view class="schedule-status" wx:if="{{item.status === 'current'}}">
          <text class="status-text">è¿›è¡Œä¸­</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºè¯¾è¡¨æç¤º -->
  <view class="section" wx:elif="{{isLoggedIn && homeData.today_schedule.length === 0}}">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥è¯¾è¡¨</text>
    </view>
    <view class="empty-schedule">
      <image src="/assets/icons/schedule.png" class="empty-icon"></image>
      <text class="empty-text">ä»Šå¤©æ²¡æœ‰è¯¾ç¨‹å®‰æ’</text>
      <text class="empty-tip">äº«å—ç¾å¥½çš„ä¸€å¤©å§ï¼</text>
    </view>
  </view>

  <!-- æœ€æ–°å…¬å‘Š -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">æœ€æ–°å…¬å‘Š</text>
      <text class="section-more" bindtap="navigateTo" data-url="/pages/announcements/announcements">æ›´å¤š</text>
    </view>
    <view class="announcement-list">
      <view 
        class="announcement-item" 
        wx:for="{{homeData.announcements}}" 
        wx:key="id" 
        bindtap="navigateToAnnouncement" 
        data-id="{{item.id}}"
      >
        <view class="announcement-header">
          <text class="announcement-title">{{item.title}}</text>
          <view class="announcement-badges">
            <text class="urgent-badge" wx:if="{{item.urgent}}">ç´§æ€¥</text>
            <text class="category-badge">{{item.category}}</text>
          </view>
        </view>
        <view class="announcement-meta">
          <text class="announcement-department">{{item.department}}</text>
          <text class="announcement-date">{{item.date}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½æ¨èï¼ˆæœªç™»å½•æ—¶æ˜¾ç¤ºï¼‰ -->
  <view class="section feature-section" wx:if="{{!isLoggedIn}}">
    <view class="section-header">
      <text class="section-title">åŠŸèƒ½ç‰¹è‰²</text>
    </view>
    <view class="feature-list">
      <view class="feature-item">
        <view class="feature-icon">ğŸ“š</view>
        <view class="feature-content">
          <text class="feature-title">æ™ºèƒ½è¯¾è¡¨</text>
          <text class="feature-desc">è‡ªåŠ¨åŒæ­¥è¯¾ç¨‹å®‰æ’ï¼Œæé†’ä¸Šè¯¾æ—¶é—´</text>
        </view>
      </view>
      <view class="feature-item">
        <view class="feature-icon">ğŸ“Š</view>
        <view class="feature-content">
          <text class="feature-title">æˆç»©æŸ¥è¯¢</text>
          <text class="feature-desc">å®æ—¶æŸ¥çœ‹è€ƒè¯•æˆç»©å’Œå­¦åˆ†æƒ…å†µ</text>
        </view>
      </view>
      <view class="feature-item">
        <view class="feature-icon">ğŸ’³</view>
        <view class="feature-content">
          <text class="feature-title">æ ¡å›­å¡</text>
          <text class="feature-desc">æŸ¥çœ‹ä½™é¢ã€æ¶ˆè´¹è®°å½•å’Œå……å€¼</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨è·ç¦» -->
  <view class="safe-area-bottom"></view>
</view>

<!-- å…¬å‘Šè¯¦æƒ…å¼¹çª— -->
<t-dialog
  visible="{{showDialog}}"
  title="{{dialogData.title}}"
  content="{{dialogData.content}}"
  confirm-btn="æŸ¥çœ‹è¯¦æƒ…"
  cancel-btn="å…³é—­"
  bind:confirm="onDialogConfirm"
  bind:cancel="onDialogCancel"
></t-dialog> 