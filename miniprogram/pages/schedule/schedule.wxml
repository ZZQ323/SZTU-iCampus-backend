<view class="container">
  <custom-navbar 
    title="è¯¾è¡¨" 
    background="#4a90e2"
    color="#ffffff"
  />
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <t-loading wx:if="{{loading}}" theme="dots" size="40rpx" text="æ­£åœ¨åŠ è½½è¯¾è¡¨..." />
  
  <view class="schedule-container" wx:else>
    <!-- å‘¨æ¬¡é€‰æ‹©å’Œæ“ä½œæŒ‰é’® -->
    <view class="week-selector">
      <view class="week-info">
        <text class="week-text">ç¬¬{{currentWeek}}å‘¨</text>
        <t-button size="small" variant="outline" bindtap="changeWeek">åˆ‡æ¢å‘¨æ¬¡</t-button>
      </view>
      <view class="action-buttons">
        <t-button size="small" theme="primary" bindtap="customSchedule">ğŸ“ è‡ªå®šä¹‰è¯¾è¡¨</t-button>
        <t-button size="small" variant="outline" bindtap="importSchedule">ğŸ“¥ å¯¼å…¥è¯¾è¡¨</t-button>
      </view>
    </view>
    
    <!-- è¯¾è¡¨è¡¨æ ¼ -->
    <view class="schedule-table">
      <!-- è¡¨å¤´ -->
      <view class="table-header">
        <view class="time-header">æ—¶é—´</view>
        <view class="day-header" wx:for="{{weekDays}}" wx:key="*this">{{item}}</view>
      </view>
      
      <!-- æ—¶é—´æ®µè¡Œ -->
      <view class="time-row" wx:for="{{timeSlots}}" wx:key="time" wx:for-item="timeSlot">
        <!-- æ—¶é—´åˆ— -->
        <view class="time-cell">
          <view class="time-label">{{timeSlot.label}}</view>
          <view class="time-range">{{timeSlot.time}}</view>
        </view>
        
        <!-- è¯¾ç¨‹åˆ— -->
        <view class="course-cell" wx:for="{{[1,2,3,4,5,6,7]}}" wx:key="*this" wx:for-item="day">
          <view class="course-item" 
                wx:for="{{weekSchedule[day]}}" 
                wx:key="id"
                wx:if="{{item.start_time >= timeSlot.time.split('-')[0] && item.start_time < timeSlot.time.split('-')[1]}}"
                bindtap="viewCourseDetail"
                data-course="{{item}}">
            <view class="course-name">{{item.course_name}}</view>
            <view class="course-teacher">{{item.teacher}}</view>
            <view class="course-location">{{item.classroom}}</view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- è¯¾ç¨‹åˆ—è¡¨è§†å›¾ -->
    <view class="course-list-view">
      <view class="section-title">æœ¬å‘¨è¯¾ç¨‹è¯¦æƒ…</view>
      <view class="daily-courses" wx:for="{{weekDays}}" wx:key="*this" wx:for-index="dayIndex">
        <view class="day-title">{{item}} ({{weekSchedule[dayIndex + 1].length}}èŠ‚è¯¾)</view>
        <view class="courses">
          <view class="course-card" 
                wx:for="{{weekSchedule[dayIndex + 1]}}" 
                wx:key="id"
                bindtap="viewCourseDetail"
                data-course="{{item}}">
            <view class="course-header">
              <text class="course-name">{{item.course_name}}</text>
              <text class="course-type">{{item.course_type}}</text>
            </view>
            <view class="course-info">
              <text class="course-time">{{item.start_time}}-{{item.end_time}}</text>
              <text class="course-location">{{item.classroom}}</text>
            </view>
            <view class="course-teacher">{{item.teacher}}</view>
          </view>
        </view>
        <view class="no-course" wx:if="{{weekSchedule[dayIndex + 1].length === 0}}">
          <text>ä»Šæ—¥æ— è¯¾</text>
        </view>
      </view>
    </view>
  </view>
</view> 