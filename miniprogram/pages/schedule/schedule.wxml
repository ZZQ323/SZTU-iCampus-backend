<!-- è¯¾è¡¨é¡µé¢ -->
<view class="page">
  <!-- é¡¶éƒ¨æŽ§åˆ¶æ  -->
  <view class="bblank"></view>
  <view class="header">
    <view class="week-info">
      <view class="week-title">ç¬¬ {{currentWeek}} å‘¨ è¯¾ç¨‹è¡¨</view>
      <view class="week-subtitle">{{weekDays[todayIndex].name}}æ˜¯ä»Šå¤© Â· {{currentSemester}}</view>
    </view>
    <view class="header-actions">
      <t-button theme="light" size="small" bindtap="changeWeek">é€‰æ‹©å‘¨æ¬¡</t-button>
    </view>
  </view>

  <!-- è¯¾è¡¨è§†å›¾ -->
  <view class="schedule-content">
    <view wx:if="{{loading}}" class="loading">
      <t-loading size="large" text="åŠ è½½è¯¾è¡¨ä¸­..." />
    </view>

    <view wx:else class="schedule-grid">
      <!-- æ˜ŸæœŸå¤´éƒ¨ -->
      <view class="week-header">
        <view class="time-column"></view>
        <view 
          wx:for="{{weekDays}}" 
          wx:key="index"
          class="day-column {{todayIndex === index ? 'today' : ''}}"
        >
          <view class="day-name">{{item.name}}</view>
          <view class="day-date">{{item.date}}</view>
        </view>
      </view>

      <!-- è¯¾è¡¨ç½‘æ ¼ -->
      <view class="schedule-grid-content">
        <view 
          wx:for="{{timeSlots}}" 
          wx:key="slot"
          class="time-row"
          wx:for-item="timeSlot"
          wx:for-index="timeIndex"
        >
          <!-- æ—¶é—´åˆ— -->
          <view class="time-cell">
            <view class="time-period">{{timeSlot.period}}</view>
            <view class="time-range">{{timeSlot.start_time}}-{{timeSlot.end_time}}</view>
          </view>
          
          <!-- æ¯å¤©çš„è¯¾ç¨‹ -->
          <view 
            wx:for="{{weekDays}}" 
            wx:key="index"
            class="course-cell {{todayIndex === index ? 'today' : ''}}"
            wx:for-item="day"
            wx:for-index="dayIndex"
          >
            <view 
              wx:if="{{scheduleData[dayIndex] && scheduleData[dayIndex][timeIndex]}}"
              class="course-item {{scheduleData[dayIndex][timeIndex].course_type === 'å¿…ä¿®' ? 'required' : scheduleData[dayIndex][timeIndex].course_type === 'é€‰ä¿®' ? 'elective' : scheduleData[dayIndex][timeIndex].course_type === 'å®žéªŒ' ? 'lab' : 'practice'}}"
              bindtap="viewCourseDetail"
              data-course="{{scheduleData[dayIndex][timeIndex]}}"
            >
              <view class="course-name">{{scheduleData[dayIndex][timeIndex].course_name}}</view>
              <view class="course-location">{{scheduleData[dayIndex][timeIndex].classroom}}</view>
              <view class="course-teacher">{{scheduleData[dayIndex][timeIndex].teacher}}</view>
            </view>
            <view wx:else class="empty-cell" bindtap="addCourse" data-day="{{dayIndex}}" data-time="{{timeIndex}}">
              <text class="add-text">+</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥è¯¾ç¨‹å¡ç‰‡ -->
  <view class="today-courses" wx:if="{{todayCourses.length > 0}}">
    <view class="section-title">ä»Šæ—¥è¯¾ç¨‹</view>
    <scroll-view scroll-x class="course-cards">
      <view 
        wx:for="{{todayCourses}}" 
        wx:key="id"
        class="course-card {{item.status}}"
        bindtap="viewCourseDetail"
        data-course="{{item}}"
      >
        <view class="card-time">{{item.timeRange}}</view>
        <view class="card-name">{{item.course_name}}</view>
        <view class="card-info">{{item.classroom}}</view>
        <view class="card-status">{{item.statusText}}</view>
      </view>
    </scroll-view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{!loading && scheduleData.length === 0}}" class="empty-state">
    <view class="empty-icon">ðŸ“…</view>
    <view class="empty-title">æš‚æ— è¯¾ç¨‹å®‰æŽ’</view>
    <view class="empty-desc">ç‚¹å‡»"+"æ·»åŠ è¯¾ç¨‹æˆ–å¯¼å…¥è¯¾è¡¨</view>
    <t-button theme="primary" size="small" bindtap="addCourse" style="margin-top: 20rpx;">æ·»åŠ è¯¾ç¨‹</t-button>
  </view>
</view> 