<view class="container">
  <custom-navbar 
    title="校园活动" 
    background="#9c27b0"
    color="#ffffff"
  />
  
  <!-- 筛选器 -->
  <view class="filter-section">
    <view class="filter-item">
      <text class="filter-label">类型:</text>
      <picker bindchange="onTypeChange" range="{{eventTypes}}" range-key="text">
        <view class="picker-text">{{selectedTypeText}} ▼</view>
      </picker>
    </view>
    <view class="filter-item">
      <text class="filter-label">状态:</text>
      <picker bindchange="onStatusChange" range="{{eventStatuses}}">
        <view class="picker-text">{{selectedStatus}} ▼</view>
      </picker>
    </view>
  </view>
  
  <!-- 加载状态 -->
  <t-loading wx:if="{{loading}}" theme="circular" size="48rpx" text="加载中..." />
  
  <!-- 错误状态 -->
  <view wx:elif="{{error}}" class="error-state">
    <t-icon name="info-circle" size="96rpx" color="#ccc" />
    <text class="error-text">{{error}}</text>
    <t-button theme="primary" size="small" bindtap="loadEvents">重试</t-button>
  </view>
  
  <!-- 活动列表 -->
  <view wx:elif="{{events.length > 0}}" class="events-list">
    <view 
      wx:for="{{events}}" 
      wx:key="id" 
      class="event-item"
      data-event="{{item}}"
      data-id="{{item.id}}"
      data-title="{{item.title}}"
      data-description="{{item.description}}"
      data-organizer="{{item.organizer}}"
      data-location="{{item.location}}"
      data-start_time="{{item.start_time}}"
      data-end_time="{{item.end_time}}"
      data-requirements="{{item.requirements}}"
      data-contact_info="{{item.contact_info}}"
      bindtap="viewEventDetail"
    >
      <view class="event-header">
        <view class="event-title">{{item.title}}</view>
        <view class="event-badges">
          <text class="type-badge type-{{item.event_type}}">{{item.event_type === 'academic' ? '学术' : item.event_type === 'social' ? '社团' : item.event_type === 'sports' ? '体育' : item.event_type === 'cultural' ? '文化' : '比赛'}}</text>
          <text class="status-badge status-{{item.status}}">{{item.status === 'upcoming' ? '即将开始' : item.status === 'ongoing' ? '进行中' : '已结束'}}</text>
        </view>
      </view>
      
      <view class="event-time">
        <t-icon name="time" size="24rpx" color="#666" />
        <text class="time-text">{{item.start_time}} - {{item.end_time}}</text>
      </view>
      
      <view class="event-location">
        <t-icon name="location" size="24rpx" color="#666" />
        <text class="location-text">{{item.location}}</text>
      </view>
      
      <view class="event-organizer">
        <t-icon name="user" size="24rpx" color="#666" />
        <text class="organizer-text">{{item.organizer}}</text>
      </view>
      
      <view wx:if="{{item.max_participants}}" class="event-participants">
        <t-icon name="user-group" size="24rpx" color="#666" />
        <text class="participants-text">{{item.current_participants}}/{{item.max_participants}}人</text>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{item.participationPercent}}\%"></view>
        </view>
      </view>
      
      <view class="event-description">{{item.description}}</view>
    </view>
  </view>
  
  <!-- 空状态 -->
  <view wx:else class="empty-state">
    <t-icon name="calendar" size="96rpx" color="#ccc" />
    <text class="empty-text">暂无活动</text>
  </view>
</view> 