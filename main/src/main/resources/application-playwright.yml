# ==================== Playwright 会话管理配置 ====================
# 
# 本配置文件包含 Playwright 浏览器管理、对象池、学校网关等相关配置
# 请根据实际环境修改相应的值
#

# Playwright 浏览器配置
playwright:
  # 是否使用无头模式（生产环境建议 true，调试时可设为 false）
  headless: true
  
  # 浏览器类型：chromium / firefox / webkit
  # chromium 兼容性最好，推荐使用
  browser-type: chromium
  
  # 默认超时时间（毫秒）
  # 包括元素等待、脚本执行等操作
  timeout: 30000
  
  # 导航超时时间（毫秒）
  # page.goto() 的专用超时，网关登录可能需要较长时间
  navigation-timeout: 60000
  
  # 模拟的 User-Agent
  # 使用真实浏览器的 UA，避免被识别为爬虫
  user-agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
  
  # 视口尺寸
  viewport-width: 1920
  viewport-height: 1080
  
  # 是否忽略 HTTPS 证书错误
  # 校园网可能使用自签名证书，建议开启
  ignore-https-errors: true
  
  # 浏览器启动参数
  launch-args:
    - "--disable-blink-features=AutomationControlled"  # 隐藏自动化特征
    - "--disable-dev-shm-usage"                        # 防止共享内存不足（Docker）
    - "--no-sandbox"                                   # Docker 环境需要
    - "--disable-gpu"                                  # 无头模式下禁用 GPU
    - "--disable-extensions"                           # 禁用扩展
  
  # BrowserContext 对象池配置
  pool:
    # 最大 Context 数量
    # 根据服务器内存调整，每个 Context 约占用 50-100MB
    max-total: 10
    
    # 最大空闲 Context 数量
    max-idle: 5
    
    # 最小空闲 Context 数量
    # 预创建这么多 Context，减少首次请求延迟
    min-idle: 2
    
    # 获取 Context 的最大等待时间（毫秒）
    # 超过此时间会抛出异常
    max-wait-millis: 10000
    
    # 空闲 Context 存活时间（毫秒）
    # 超过此时间的空闲 Context 会被回收
    min-evictable-idle-time-millis: 300000
    
    # 归还时是否清理 Cookie
    # 建议 true，确保每次获取的是干净的 Context
    clear-cookies-on-return: true
  
  # 学校网关配置
  school:
    # 网关地址（不要在这里配置，使用下面的 school.url.gateway）
    gateway-url: ${school.url.gateway}
    
    # 登录成功后的 URL 模式
    # 用于判断登录是否成功
    login-success-url-pattern: "/portal"
    
    # 登录错误消息的 CSS 选择器
    login-error-selector: ".login-error, .error-msg, #errorMsg, .alert-danger"


# ==================== 学校系统 URL 配置 ====================

school:
  url:
    # 统一身份认证网关地址
    # 这是最重要的配置，请替换为你学校的实际地址
    gateway: "https://home.sztu.edu.cn/bmportal"
    
    # 发送短信验证码的接口地址
    sms: "https://auth-sztu-edu-cn-s.webvpn.sztu.edu.cn:8118/idp/sendSMSCheckCode.do?sf_request_type=ajax"
    
    # 登录提交地址（通常与 gateway 相同）
    login: "https://auth-sztu-edu-cn-s.webvpn.sztu.edu.cn:8118/idp/authcenter/ActionAuthChain?entityId=webvpn"
    
    # 登录成功后跳转的首页
    portal: "https://portal.your-school.edu.cn"


# ==================== Redis 缓存配置 ====================

spring:
  redis:
    # Redis 服务器地址
    host: localhost
    port: 6379
    # 密码（如果有）
    password: 
    # 数据库索引
    database: 0
    # 连接超时时间
    timeout: 5000ms
    
    # Lettuce 连接池配置
    lettuce:
      pool:
        # 最大连接数
        max-active: 20
        # 最大空闲连接
        max-idle: 10
        # 最小空闲连接
        min-idle: 5
        # 获取连接的最大等待时间
        max-wait: 5000ms


# ==================== 日志配置 ====================

logging:
  level:
    # Playwright 相关日志
    cn.edu.sztui.base.domain.model.proxy.browser: DEBUG
    cn.edu.sztui.base.domain.model.proxy.session: DEBUG
    cn.edu.sztui.base.domain.model.proxy.login: DEBUG
    
    # 应用层日志
    cn.edu.sztui.base.application.service: INFO
    
    # 连接池日志
    org.apache.commons.pool2: WARN
    
    # Playwright 内部日志（调试时可开启）
    com.microsoft.playwright: WARN


# ==================== 会话缓存配置 ====================

proxy:
  session:
    # 设备初始化会话过期时间（秒）
    # 仅用于登录流程，建议 30 分钟
    device-init-expire: 1800
    
    # 用户登录会话过期时间（秒）
    # 建议 7 天，可根据需求调整
    user-session-expire: 604800
    
    # 设备账号列表过期时间（秒）
    # 建议 30 天
    device-accounts-expire: 2592000
