# SZTU-iCampus Backend

æ·±åœ³æŠ€æœ¯å¤§å­¦æ ¡å›­æœåŠ¡å°ç¨‹åºåç«¯APIæœåŠ¡

## å·²å®ç°åŠŸèƒ½

- ç”¨æˆ·è®¤è¯ä¸æˆæƒ
- æ ¡å›­å…¬å‘Šã€éƒ¨é—¨é€šçŸ¥
- è¯¾è¡¨æŸ¥è¯¢ä¸ç®¡ç†
- æ´»åŠ¨æ—¥å†
- æˆç»©æŸ¥è¯¢
- è€ƒè¯•å®‰æ’ä¸å€’è®¡æ—¶
- æ ¡å›­å¡æœåŠ¡
- å›¾ä¹¦é¦†æœåŠ¡ï¼ˆå€Ÿé˜…ã€åº§ä½é¢„çº¦ã€å›¾ä¹¦èè´­ï¼‰
- å›¾å½¢åŒ–è‡ªå®šä¹‰è¯¾è¡¨
- é€šè®¯å½•æœåŠ¡
- **ğŸ”§ ç®¡ç†å‘˜ç³»ç»Ÿ**ï¼ˆæ–°å¢ï¼‰
  - ç”¨æˆ·æƒé™ç®¡ç†
  - å…¬å‘Šå’Œé€šçŸ¥ç®¡ç†
  - ç³»ç»Ÿç»Ÿè®¡æŸ¥çœ‹
  - ç®¡ç†å‘˜æƒé™æ§åˆ¶

## å¾…å®ç°åŠŸèƒ½

## æŠ€æœ¯æ ˆ

- åç«¯ï¼šFastAPI
- æ•°æ®åº“ï¼šAlembic+ SQLAlchemy + Pydantic + SQLite/PostgreSQL
- JWTè®¤è¯
- å‰ç«¯ï¼šminiprogramme+tdesign

## å¼€å‘ç¯å¢ƒè®¾ç½®

1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š
```bash
python -m venv venv
venv\Scripts\activate  # Windows
conda activate icamp # anaconda
```

2. å®‰è£…ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

3. åˆå§‹åŒ–æ•°æ®åº“ï¼š
```bash
python -m setup_db.py
```

4. è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼š
```bash
uvicorn main:app --reload
```

5. ä½¿ç”¨postmanæˆ–è€…å…¶ä»–å·¥å…·ä¿è¯è·¯ç”±æ­£å¸¸ï¼›


## APIæ–‡æ¡£

å¯åŠ¨æœåŠ¡å™¨åè®¿é—®ï¼š
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ alembic/              # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/             # APIè·¯ç”±
â”‚   â”œâ”€â”€ core/            # æ ¸å¿ƒé…ç½®ï¼ˆé…ç½®ã€å®‰å…¨ã€é˜Ÿåˆ—ï¼‰ï¼Œè¢«æ‰€æœ‰å±‚è°ƒç”¨
â”‚   â”œâ”€â”€ crud/            # CRUDæ“ä½œå­˜å–å°è£…
â”‚   â”œâ”€â”€ db/              # æ•°æ®åº“
â”‚   â”œâ”€â”€ models/          # SQLAlchemy ä½¿ç”¨ ORM æ¨¡å‹
â”‚   â””â”€â”€ schemas/         # Pydantic æ¨¡å‹ï¼Œåšæ•°æ®éªŒè¯ç”¨çš„
â”œâ”€â”€ tests/               # æµ‹è¯•
â”œâ”€â”€ requirements.txt     # ä¾èµ–
â””â”€â”€ README.md           # æ–‡æ¡£
```

## éƒ¨ç½²

1. è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
export SECRET_KEY="your-secret-key"
export DATABASE_URL="postgresql://user:password@localhost/dbname"
```

2. è¿è¡Œç”Ÿäº§æœåŠ¡å™¨ï¼š
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

## æ ¹ç›®å½•

```
./
â”œâ”€â”€ .git/                    # Gitç‰ˆæœ¬æ§åˆ¶ç›®å½•
â”œâ”€â”€ README.md               # é¡¹ç›®ä¸»æ–‡æ¡£ï¼ŒåŒ…å«é¡¹ç›®è¯´æ˜å’Œä½¿ç”¨æŒ‡å—
â”œâ”€â”€ miniprogram/            # å¾®ä¿¡å°ç¨‹åºå‰ç«¯ä»£ç 
â”œâ”€â”€ backend/                # FastAPIåç«¯ä»£ç 
â”œâ”€â”€ QUICK_START.md          # å¿«é€Ÿå¯åŠ¨æŒ‡å—
â”œâ”€â”€ .gitignore              # Gitå¿½ç•¥æ–‡ä»¶é…ç½®
â”œâ”€â”€ clean.bat               # Windowsç¯å¢ƒæ¸…ç†è„šæœ¬
â”œâ”€â”€ project.config.json     # å¾®ä¿¡å°ç¨‹åºé¡¹ç›®é…ç½®æ–‡ä»¶
â””â”€â”€ project.private.config.json  # å¾®ä¿¡å°ç¨‹åºç§æœ‰é…ç½®æ–‡ä»¶
```

## å‰ç«¯ç›®å½• (miniprogram/)

```
miniprogram/
â”œâ”€â”€ project.config.json     # å°ç¨‹åºé¡¹ç›®é…ç½®
â”œâ”€â”€ project.private.config.json  # å°ç¨‹åºç§æœ‰é…ç½®
â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°ç›®å½•
â”‚   â””â”€â”€ stream.js          # æµå¼æ•°æ®å¤„ç†ç®¡ç†å™¨
â”œâ”€â”€ pages/                  # é¡µé¢æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ index/             # é¦–é¡µ
â”‚   â”œâ”€â”€ events/            # æ´»åŠ¨é¡µé¢
â”‚   â””â”€â”€ ...                # å…¶ä»–é¡µé¢
â”œâ”€â”€ components/            # å¯å¤ç”¨ç»„ä»¶ç›®å½•
â”œâ”€â”€ assets/                # é™æ€èµ„æºç›®å½•ï¼ˆå›¾ç‰‡ç­‰ï¼‰
â”œâ”€â”€ miniprogram_npm/       # å°ç¨‹åºnpmåŒ…ç›®å½•
â”œâ”€â”€ node_modules/          # Node.jsä¾èµ–åŒ…ç›®å½•
â”œâ”€â”€ app.wxss              # å…¨å±€æ ·å¼æ–‡ä»¶
â”œâ”€â”€ app.json              # å°ç¨‹åºå…¨å±€é…ç½®
â”œâ”€â”€ app.js                # å°ç¨‹åºå…¥å£æ–‡ä»¶
â””â”€â”€ sitemap.json          # å°ç¨‹åºç«™ç‚¹åœ°å›¾é…ç½®
```

## åç«¯ç›®å½• (backend/)

```
backend/
â”œâ”€â”€ main.py               # FastAPIä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ sztu_icampus.db       # SQLiteæ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ setup_db.py           # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ run.py                # æœåŠ¡å™¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ app/                  # åº”ç”¨æ ¸å¿ƒä»£ç ç›®å½•
â”‚   â”œâ”€â”€api/	    æ¥å£è·¯ç”±å’Œåˆ†ç»„,æ¥å£å¤§é—¨
â”‚      â”œâ”€â”€v1/	    ç‰ˆæœ¬å·åˆ†ç»„
â”‚      â””â”€â”€deps.py	    ä¾èµ–é¡¹
â”‚   â”œâ”€â”€core/	å…¨å±€é…ç½®ã€å®‰å…¨,å¤§è„‘å’Œä¿é™©ç®±
â”‚   â”œâ”€â”€crud/	æ•°æ®åº“æ“ä½œå°è£…,æ•°æ®åº“å·¥å…·ç®±
â”‚   â”œâ”€â”€db/	    æ•°æ®åº“è¿æ¥ã€æ¨¡å‹æ³¨å†Œ,æ•°æ®åº“å…¥å£å’Œæ³¨å†Œå¤„
â”‚   â”œâ”€â”€models/	æ•°æ®åº“è¡¨ç»“æ„å®šä¹‰,è¡¨çš„è“å›¾
â”‚   â”œâ”€â”€schemas/	æ¥å£æ•°æ®æ ¼å¼å’Œæ ¡éªŒ,æ•°æ®è¯´æ˜ä¹¦
â”‚   â”œâ”€â”€utils.py	å·¥å…·å‡½æ•°,å°å·¥å…·
â”‚   â””â”€â”€queue.py	å¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—,æ¶ˆæ¯ä¸­è½¬ç«™
â”œâ”€â”€ init.bat              # Windowsç¯å¢ƒåˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ alembic/              # æ•°æ®åº“è¿ç§»å·¥å…·ç›®å½•
â””â”€â”€ alembic.ini           # Alembicé…ç½®æ–‡ä»¶
```

## ğŸ”§ ç®¡ç†å‘˜åŠŸèƒ½ä½¿ç”¨è¯´æ˜

### 1. ç®¡ç†å‘˜æƒé™è®¾ç½®
ç®¡ç†å‘˜æƒé™é€šè¿‡æ•°æ®åº“ä¸­çš„ `is_admin` å­—æ®µæ§åˆ¶ï¼š
```sql
-- è®¾ç½®ç”¨æˆ·ä¸ºç®¡ç†å‘˜
UPDATE users SET is_admin = true WHERE student_id = 'YOUR_STUDENT_ID';
```

### 2. ç®¡ç†å‘˜åŠŸèƒ½å…¥å£
- ç®¡ç†å‘˜ç”¨æˆ·ç™»å½•åï¼Œåœ¨é¦–é¡µç”¨æˆ·ä¿¡æ¯å¡ç‰‡å³ä¸Šè§’ä¼šæ˜¾ç¤ºé‡‘è‰²çš„"ğŸ”§ ç®¡ç†"æŒ‰é’®
- ç‚¹å‡»è¯¥æŒ‰é’®å³å¯è¿›å…¥ç®¡ç†å‘˜ä¸­å¿ƒ

### 3. ç®¡ç†å‘˜åŠŸèƒ½åˆ—è¡¨
- **ğŸ‘¥ ç”¨æˆ·ç®¡ç†**: æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ï¼Œå¯ä»¥è®¾ç½®/å–æ¶ˆç®¡ç†å‘˜æƒé™
- **ğŸ“¢ å…¬å‘Šç®¡ç†**: æŸ¥çœ‹å’Œåˆ é™¤æ ¡å›­å…¬å‘Š
- **ğŸ“‹ é€šçŸ¥ç®¡ç†**: æŸ¥çœ‹å’Œåˆ é™¤éƒ¨é—¨é€šçŸ¥
- **ğŸ“Š ç³»ç»Ÿç»Ÿè®¡**: æŸ¥çœ‹ç”¨æˆ·æ•°é‡ã€ç®¡ç†å‘˜æ•°é‡ã€å…¬å‘Šæ•°é‡ç­‰ç»Ÿè®¡ä¿¡æ¯

### 4. æƒé™ä¿æŠ¤
- æ‰€æœ‰ç®¡ç†å‘˜APIéƒ½æœ‰æƒé™éªŒè¯ï¼Œéç®¡ç†å‘˜ç”¨æˆ·æ— æ³•è®¿é—®
- ç®¡ç†å‘˜é¡µé¢ä¼šè‡ªåŠ¨æ£€æŸ¥ç”¨æˆ·æƒé™ï¼Œéç®¡ç†å‘˜ä¼šè¢«é‡å®šå‘

### 5. APIç«¯ç‚¹
- `GET /api/admin/stats` - è·å–ç³»ç»Ÿç»Ÿè®¡
- `GET /api/admin/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `POST /api/admin/users/{user_id}/toggle-admin` - åˆ‡æ¢ç”¨æˆ·ç®¡ç†å‘˜çŠ¶æ€
- `GET /api/admin/announcements` - è·å–å…¬å‘Šåˆ—è¡¨
- `DELETE /api/admin/announcements/{id}` - åˆ é™¤å…¬å‘Š
- `GET /api/admin/notices` - è·å–é€šçŸ¥åˆ—è¡¨
- `DELETE /api/admin/notices/{id}` - åˆ é™¤é€šçŸ¥

## ğŸ”„ æ–°å¢APIç«¯ç‚¹

### è€ƒè¯•ç®¡ç† (Exams)
- `GET /api/v1/exams/` - è·å–è€ƒè¯•åˆ—è¡¨
- `GET /api/v1/exams/{exam_id}` - è·å–è€ƒè¯•è¯¦æƒ…
- `GET /api/v1/exams/countdown/{exam_id}` - è·å–è€ƒè¯•å€’è®¡æ—¶

### å›¾ä¹¦é¦†æœåŠ¡ (Library) 
- `GET /api/v1/library/borrow-info` - è·å–å€Ÿé˜…ä¿¡æ¯
- `GET /api/v1/library/search` - å›¾ä¹¦æœç´¢
- `GET /api/v1/library/seats` - è·å–åº§ä½ä¿¡æ¯
- `POST /api/v1/library/seat-reservation` - é¢„çº¦åº§ä½
- `GET /api/v1/library/reservations` - è·å–é¢„çº¦è®°å½•
- `POST /api/v1/library/recommend` - å›¾ä¹¦èè´­
- `GET /api/v1/library/recommendations` - è·å–èè´­è®°å½•
- `POST /api/v1/library/renew` - å›¾ä¹¦ç»­å€Ÿ

### è¯¾è¡¨ç®¡ç† (Schedule)
- `GET /api/v1/schedule/grid/{week_number}` - è·å–æŒ‡å®šå‘¨è¯¾è¡¨ç½‘æ ¼
- `GET /api/v1/schedule/current-week` - è·å–å½“å‰å‘¨è¯¾è¡¨
- `POST /api/v1/schedule/` - åˆ›å»ºæ–°è¯¾ç¨‹
- `GET /api/v1/schedule/time-slots/info` - è·å–æ—¶é—´æ®µä¿¡æ¯

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## è®¸å¯è¯

MIT 

## å‚è€ƒ

[å‘ï¼šssh: connect to host github.com port 22: Connection refused - æ— å¿Œçš„æ–‡ç«  - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/521340971)

[å…¨ç½‘æœ€å…¨é¢è¯¦ç»†çš„Cursorä½¿ç”¨æ•™ç¨‹ï¼Œè®©å¼€å‘å˜æˆèŠå¤©ä¸€æ ·å®¹æ˜“](https://blog.csdn.net/m0_68116052/article/details/142832657?fromshare=blogdetail&sharetype=blogdetail&sharerId=142832657&sharerefer=PC&sharesource=Shadowfight323&sharefrom=from_link)

[è§£å†³ Cursor è¿æ¥å¤±è´¥çš„å°æŠ€å·§ - ä¸€ä¸ªå¯¼èˆªçš„æ–‡ç«  - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/1907071064191771454)